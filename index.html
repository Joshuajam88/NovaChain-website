<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NovaChain — Glass Portal v2</title>
    <meta name="description" content="NovaChain — Bitcoin read-only dashboard"/>
    <style>
      :root{
        --bg: rgba(2,6,23,1);
        --glass: rgba(255,255,255,0.04);
        --muted: #9aa6b2;
        --accent1: #7c3aed;
        --accent2: #06b6d4;
        --card-blur: 8px;
      }
      *{box-sizing:border-box}
      html,body{height:100%;margin:0;font-family:Inter, system-ui, Arial, sans-serif;background:linear-gradient(180deg,#071025 0%, #02040a 100%);color:#e6eef8}
      .wrap{max-width:1100px;margin:20px auto;padding:18px}
      .nav{display:flex;align-items:center;gap:12px}
      .logoText{font-weight:800;font-size:20px;letter-spacing:1px;background:linear-gradient(90deg,var(--accent1),var(--accent2));-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 6px 30px rgba(124,58,237,0.08)}
      .topControls{margin-left:auto;display:flex;gap:8px;align-items:center}
      .btn{background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;padding:10px 14px;border-radius:10px;color:white;cursor:pointer;box-shadow:0 6px 18px rgba(6,182,212,0.06)}
      .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
      .glassCard{backdrop-filter:blur(var(--card-blur));background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:16px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
      .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px}
      .input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:rgba(11,18,32,0.6);color:inherit}
      .addr{font-family:monospace;background:rgba(7,16,38,0.6);padding:8px;border-radius:8px}
      .small{color:var(--muted);font-size:13px}
      .tx{padding:10px;border-radius:8px;background:rgba(7,16,38,0.6);margin-bottom:8px}
      .adminBadge{display:inline-block;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,#06384b,#0b6d5a);color:#d8fde8;font-weight:700}
      .footer{text-align:center;color:var(--muted);margin-top:16px;font-size:13px}
      .modalBg{position:fixed;inset:0;background:rgba(2,6,23,0.6);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;z-index:50}
      .modal{width:90%;max-width:420px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.06);padding:18px;border-radius:12px} 
      .tabs{display:flex;gap:8px;margin-bottom:12px}
      .tabBtn{flex:1;padding:10px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
      .tabActive{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;border:none}
      @media(max-width:820px){.grid{grid-template-columns:1fr} .topControls{flex-wrap:wrap}}
      @media(max-width:420px){.logoText{font-size:18px} .btn{padding:8px 10px}}
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="nav">
        <div class="logoText">NovaChain</div>
        <div class="small" style="margin-left:8px;margin-top:4px">Bitcoin Glass Portal</div>
        <div class="topControls">
          <button id="connectWalletBtn" class="btn ghost">Connect Wallet</button>
          <button id="openLogin" class="btn">Login / Register</button>
        </div>
      </div>
      <div class="grid">
        <div>
          <div class="glassCard" id="mainCard">
            <div style="display:flex;justify-content:space-between;align-items:start;gap:12px">
              <div>
                <div class="small">Connected Address</div>
                <div id="displayAddr" class="addr">Not connected</div>
              </div>
              <div style="text-align:right">
                <div class="small">Balance</div>
                <div id="displayBalance" style="font-weight:800;font-size:20px">— BTC</div>
                <div class="small" id="displaySats">— sats</div>
                <div id="adminFlag" style="margin-top:8px"></div>
              </div>
            </div>
            <div style="margin-top:12;display:flex;gap:8px;align-items:center">
              <input id="addrInput" class="input" placeholder="Enter or paste BTC bech32 address (bc1...)" />
              <button id="viewBtn" class="btn">View</button>
            </div>
            <div id="error" style="color:#ffb4b4;margin-top:8px"></div>
            <div id="txList" style="margin-top:12"></div>
          </div>
          <div style="margin-top:12" class="glassCard">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:700">Activity Feed</div>
              <div class="small">Live on-chain data</div>
            </div>
            <div id="activity" style="margin-top:12"></div>
          </div>
        </div>
        <div>
          <div class="glassCard">
            <div class="small">Network</div>
            <div style="font-weight:800;margin-top:6px">Bitcoin Mainnet</div>
            <div class="small" style="margin-top:10px">Admin address (locked)</div>
            <div class="addr" id="adminAddr">bc1q2ld78maaw2qkc8usgqtcpvq2ua6x47lt3u0lsu</div>
            <div style="margin-top:12">
              <button id="openAdminPanel" class="btn">Open Admin Panel</button>
            </div>
          </div>
          <div style="margin-top:12" class="glassCard">
            <div class="small">Share</div>
            <div style="margin-top:8px" class="small">Use QR or copy address</div>
            <canvas id="qrCanvas" style="width:100%;background:rgba(7,16,38,0.6);border-radius:8px;height:128px"></canvas>
            <div class="small" style="margin-top:8px">Tip: click address to copy</div>
          </div>
        </div>
      </div>
      <div class="footer">NovaChain • Glass Portal • © 2025</div>
    </div>
    <div id="modalBg" class="modalBg">
      <div class="modal glassCard">
        <div style="text-align:center;margin-bottom:6px"><div style="font-weight:800;font-size:18px; background:linear-gradient(90deg,var(--accent1),var(--accent2)); -webkit-background-clip:text;background-clip:text;color:transparent">NovaChain</div></div>
        <div class="tabs">
          <button id="tabLogin" class="tabBtn tabActive">Login</button>
          <button id="tabReg" class="tabBtn">Register</button>
        </div>
        <div id="formArea"></div>
        <div style="margin-top:12;display:flex;justify-content:center">
          <button id="closeModal" class="btn ghost">Close</button>
        </div>
      </div>
    </div>
    <div id="adminModal" class="modalBg">
      <div class="modal glassCard" style="max-width:720px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:800">Admin Dashboard</div>
          <div><button id="closeAdmin" class="btn ghost">Close</button></div>
        </div>
        <div id="adminContent" style="margin-top:12"></div>
      </div>
    </div>
    <script>
      const ADMIN = "bc1q2ld78maaw2qkc8usgqtcpvq2ua6x47lt3u0lsu";
      const BLOCKSTREAM = "https://blockstream.info/api";
      const addrInput = document.getElementById("addrInput");
      const viewBtn = document.getElementById("viewBtn");
      const displayAddr = document.getElementById("displayAddr");
      const displayBalance = document.getElementById("displayBalance");
      const displaySats = document.getElementById("displaySats");
      const txList = document.getElementById("txList");
      const activity = document.getElementById("activity");
      const errorEl = document.getElementById("error");
      const adminFlag = document.getElementById("adminFlag");
      const qrCanvas = document.getElementById("qrCanvas");
      const modalBg = document.getElementById("modalBg");
      const openLogin = document.getElementById("openLogin");
      const closeModal = document.getElementById("closeModal");
      const tabLogin = document.getElementById("tabLogin");
      const tabReg = document.getElementById("tabReg");
      const formArea = document.getElementById("formArea");
      const connectWalletBtn = document.getElementById("connectWalletBtn");
      const adminModal = document.getElementById("adminModal");
      const openAdminPanel = document.getElementById("openAdminPanel");
      const adminContent = document.getElementById("adminContent");
      const closeAdmin = document.getElementById("closeAdmin");
      function saveUser(user){ localStorage.setItem("nc_user", JSON.stringify(user)); }
      function getUser(){ const s = localStorage.getItem("nc_user"); return s? JSON.parse(s): null; }
      function logout(){ localStorage.removeItem("nc_user"); renderUser(); }
      function renderUser(){ const u = getUser(); if(u && u.addr){ displayAddr.textContent = u.addr; fetchAndRender(u.addr); } }
      function showModal(){ modalBg.style.display = "flex"; renderLoginForm(); }
      function hideModal(){ modalBg.style.display = "none"; }
      openLogin.addEventListener("click", showModal);
      closeModal.addEventListener("click", hideModal);
      modalBg.addEventListener("click", (e)=>{ if(e.target===modalBg) hideModal(); });
      tabLogin.addEventListener("click", ()=>{ tabLogin.classList.add("tabActive"); tabReg.classList.remove("tabActive"); renderLoginForm(); });
      tabReg.addEventListener("click", ()=>{ tabReg.classList.add("tabActive"); tabLogin.classList.remove("tabActive"); renderRegisterForm(); });
      function renderLoginForm(){
        formArea.innerHTML = `
          <div style="display:flex;flex-direction:column;gap:8px">
            <input id="loginEmail" class="input" placeholder="Email" />
            <input id="loginPass" type="password" class="input" placeholder="Password" />
            <div style="display:flex;gap:8px;justify-content:center">
              <button id="doLogin" class="btn">Login</button>
            </div>
            <div class="small" style="text-align:center;margin-top:8px">Or paste your BTC address to link your session</div>
            <input id="linkAddr" class="input" placeholder="Paste BTC address (optional)" />
          </div>
        `;
        document.getElementById("doLogin").addEventListener("click", ()=>{
          const email = document.getElementById("loginEmail").value.trim();
          const pass = document.getElementById("loginPass").value.trim();
          const addr = document.getElementById("linkAddr").value.trim();
          if(!email || !pass) return alert("Enter email and password");
          const user = {email, addr: addr || null, addrNormalized: (addr||'').toLowerCase()};
          saveUser(user);
          hideModal();
          renderUser();
        });
      }
      function renderRegisterForm(){
        formArea.innerHTML = `
          <div style="display:flex;flex-direction:column;gap:8px">
            <input id="regUser" class="input" placeholder="Username" />
            <input id="regEmail" class="input" placeholder="Email" />
            <input id="regPass" type="password" class="input" placeholder="Password" />
            <div style="display:flex;gap:8px;justify-content:center">
              <button id="doReg" class="btn">Register</button>
            </div>
            <div class="small" style="text-align:center;margin-top:8px">You can link a BTC address later in your dashboard</div>
          </div>
        `;
        document.getElementById("doReg").addEventListener("click", ()=>{
          const username = document.getElementById("regUser").value.trim();
          const email = document.getElementById("regEmail").value.trim();
          const pass = document.getElementById("regPass").value.trim();
          if(!username || !email || !pass) return alert("Complete all fields");
          const user = {username, email};
          saveUser(user);
          hideModal();
          renderUser();
        });
      }
      connectWalletBtn.addEventListener("click", ()=>{
        const paste = prompt("Paste your BTC bech32 address here (bc1...):");
        if(paste && paste.trim()){ addrInput.value = paste.trim(); displayAddr.textContent = paste.trim(); fetchAndRender(paste.trim()); }
      });
      viewBtn.addEventListener("click", ()=>{
        const a = addrInput.value.trim();
        if(!a){ errorEl.textContent = "Enter address"; return; }
        if(!/^bc1[0-9a-zA-Z]{6,}$/i.test(a)){ errorEl.textContent = "Invalid bech32 address"; return; }
        errorEl.textContent = "";
        displayAddr.textContent = a;
        fetchAndRender(a);
      });
      document.getElementById("displayAddr").addEventListener("click", ()=>{
        const t = document.getElementById("displayAddr").textContent.trim();
        if(t && t!=="Not connected"){ navigator.clipboard.writeText(t).then(()=>alert("Address copied"), ()=>alert("Copy failed")); }
      });
      async function fetchAndRender(a){
        displayBalance.textContent = "— BTC";
        displaySats.textContent = "— sats";
        txList.innerHTML = '<div class="small">Loading...</div>';
        activity.innerHTML = "";
        adminFlag.innerHTML = "";
        try{
          const res = await fetch(BLOCKSTREAM + "/address/" + a);
          if(!res.ok) throw new Error("Address not found");
          const data = await res.json();
          const funded = data.chain_stats.funded_txo_sum || 0;
          const spent = data.chain_stats.spent_txo_sum || 0;
          const balanceSats = funded - spent;
          displayBalance.textContent = (balanceSats/1e8).toFixed(8) + " BTC";
          displaySats.textContent = balanceSats + " sats";
          if(a.toLowerCase() === ADMIN){ adminFlag.innerHTML = '<span class="adminBadge">ADMIN</span>'; }
          const txres = await fetch(BLOCKSTREAM + "/address/" + a + "/txs");
          const txs = txres.ok ? await txres.json() : [];
          if(!txs || txs.length===0){ txList.innerHTML = '<div class="small">No recent txs</div>'; }
          else {
            txList.innerHTML = "";
            txs.slice(0,10).forEach(function(tx){
              const ts = tx.status && tx.status.block_time ? new Date(tx.status.block_time*1000).toLocaleString() : "unconfirmed";
              const div = document.createElement("div");
              div.className = "tx";
              div.innerHTML = '<div style="font-weight:700;font-size:13px">'+tx.txid+'</div><div class="small">Confirmations: '+(tx.status && tx.status.confirmed ? "Confirmed" : "Unconfirmed")+' • '+ts+'</div><div style="margin-top:8px"><a class="btn link" href="bitcoin:'+a+'?amount=0.0001" rel="noreferrer">Send (open wallet)</a></div>';
              txList.appendChild(div);
            });
            activity.innerHTML = "<div class='small'>Recent: </div>";
            txs.slice(0,5).forEach(function(tx){
              const li = document.createElement("div");
              li.className = "small";
              li.style.marginTop = "8px";
              li.textContent = tx.txid + " — " + (tx.status && tx.status.block_time ? new Date(tx.status.block_time*1000).toLocaleString() : "unconfirmed");
              activity.appendChild(li);
            });
          }
          try{
            const qr = await fetch("https://api.qrserver.com/v1/create-qr-code/?size=256x256&data=" + encodeURIComponent(a));
            const blob = await qr.blob();
            const img = new Image();
            img.onload = function(){ qrCanvas.getContext('2d').clearRect(0,0,qrCanvas.width,qrCanvas.height); qrCanvas.width = img.width; qrCanvas.height = img.height; qrCanvas.getContext('2d').drawImage(img,0,0); };
            img.src = URL.createObjectURL(blob);
          }catch(e){}
        }catch(e){
          txList.innerHTML = "";
          errorEl.textContent = e.message || "Fetch failed";
        }
      }
      openAdminPanel.addEventListener("click", function(){
        var cur = displayAddr.textContent.trim().toLowerCase();
        if(cur !== ADMIN){ alert("Admin access locked to configured admin address."); return; }
        adminModal.style.display = "flex";
        adminContent.innerHTML = "<div style='font-weight:800'>Admin Overview</div><div class='small' style='margin-top:8px'>Address: "+cur+"</div><div id='adminStats' class='small' style='margin-top:8px'>Loading...</div>";
        fetch(BLOCKSTREAM + "/address/" + cur).then(function(r){ return r.json(); }).then(function(d){ var funded = d.chain_stats.funded_txo_sum||0; var spent = d.chain_stats.spent_txo_sum||0; var bal = (funded-spent)/1e8; document.getElementById("adminStats").textContent = "Balance: "+bal.toFixed(8)+" BTC • TXs: "+(d.chain_stats.tx_count||0); }).catch(function(){ document.getElementById("adminStats").textContent = "Failed to load"; });
      });
      closeAdmin.addEventListener("click", function(){ adminModal.style.display = "none"; });
      adminModal.addEventListener("click",function(e){ if(e.target===adminModal) adminModal.style.display='none'; });
      var savedUser = localStorage.getItem("nc_user");
      if(savedUser){ try{ var u = JSON.parse(savedUser); if(u && u.addr) { addrInput.value = u.addr; displayAddr.textContent = u.addr; fetchAndRender(u.addr); } }catch(e){} }
    </script>
  </body>
</html>
